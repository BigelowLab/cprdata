---
title: "NFSC-CPR"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This R package facilitates access and analysis of [NFSC](https://www.fisheries.noaa.gov/about/northeast-fisheries-science-center) [Continuous Plankton Recorder](https://en.wikipedia.org/wiki/Continuous_Plankton_Recorder) (CPR) data.  Data can imported from distrubuted [Excel](https://en.wikipedia.org/wiki/Microsoft_Excel) spreadsheets into data frames, [tibbles](https://tibble.tidyverse.org/) or [sf tables](https://r-spatial.github.io/sf/).

>This dataset was obtained from [NOAA's NFSC](https://www.fisheries.noaa.gov/about/northeast-fisheries-science-center) on 20 January 2024 and might not represent the most up to date data. Please contact NOAA directly for the most recent data.

## Requirements

+ [R v4.1+](https://www.r-project.org/)
+ [rlang](https://CRAN.R-project.org/package=rlang)
+ [dplyr](https://CRAN.R-project.org/package=dplyr)
+ [readxl](https://CRAN.R-project.org/package=readxl)
+ [readr](https://CRAN.R-project.org/package=readr)

## Installation

```
remotes::install_github("BigelowLab/nfsccrp")
```

## Usage

### Read the data

The dataset contains both zooplankton and phytoplankton data from the Mid-Atlantic Bight.  We should access to the zooplankton data, but it is easy to switch to phytoplankton.  We can read the data in its "raw" state (a wide table), pivoted into long form or as an sf object.

####  Read as a wide table
```{r}
library(nfsccpr)
x = read_cpr(name = "zooplankton", long = FALSE, form = "table")
x
```


#### Read as a long table
```{r}
x = read_cpr(name = "zooplankton", long = TRUE, form = "table")
x
```

#### Read as a long table cast to sf
```{r}
x = read_cpr(name = "zooplankton", long = TRUE, form = "sf")
x
```




### Import a raw data file

The data were shared as a large two-sheet Excel document. It's difficult to know if the format of the raw data file will remain as that distributed in January 2024.  Importing the one we were provided is encoded in a package function.  The package can be adapted for other formats but may require a small effort in adapting the code.

```{r}
ff = "/Users/ben/Library/CloudStorage/Dropbox/data/noaa/nmfs/cpr/MAB CPR (Jan 20, 2024 update).xlsx"
x = import_cpr(ff[1])
x
```